exports.moduleList=(()=>{"use strict";const e=(e,o,a)=>{let r;const s=document.location,t=""===s.port?"https:"===s.protocol?443:80:s.port,l=`${s.protocol}//${s.hostname}:${t}/`,i=location.pathname.split("/"),_=i.slice(0,i.length-2).join("/")+"/",p=_.substring(1)+"socket.io",d=l+"pluginfw/admin/ep_profile_modal";switch(o){case"admin/ep_profile_modal":r=io.connect(d,{path:_+"socket.io",resource:p}),r.on("load-settings-result",e=>{n.setFormData($("#settings-form"),e)}),$("#save-settings").on("click",()=>{const e=n.getFormData($("#settings-form"));r.emit("save-settings",e),alert("Succesfully saved.")}),r.emit("load-settings");break;case"admin/ep_profile_modal_analytics":r=io.connect(d,{path:_+"socket.io",resource:p}),r.on("load-pads-result",e=>{console.log("load-pads",e),$.each(e,(e,o)=>{$("#pads").append(`<option value="${o}">${o}</option>`)})}),r.on("load-analytics-result",e=>{console.log("load-analytics",e),$.each(e.pad_users_data,(e,o)=>{o.userId&&$("#users").append(`\n              <tr style="height: 0;">\n                <td>${o.email||o.userId}</td>\n                <td>${o.username}</td>\n                <td>${o.createDate}</td>\n                <td>${o.lastSeenDate}</td>\n                <td>${o.verifiedDate||"-"}</td>\n                <td>${o.verified?"Verified":"unconfirmed"}</td>\n              </tr>\n              `)})}),$("#pads").on("change",(function(){r.emit("load-analytics",{pad:this.value})})),r.emit("load-pads");break;default:return[]}},o=(()=>{const e=(e,o,a,r,s,t,l)=>{let i;return s=s||"",t=t||"",r&&"Anonymous"===o?(i=`background: url(${a}) no-repeat 50% 50% ; background-size : 69px ;`,`<div  data-user-ids='${e}' data-anonymouseCount='1' data-id='user_list_${r}' class='ep_profile_user_row'><div style='${i}' class='ep_profile_user_img' id='ep_profile_user_img'></div><div class='ep_profile_user_list_profile_userDesc'><div class='ep_profile_user_list_username'>\n<div class='ep_profile_user_list_username_text' id='ep_profile_users_profile_name'>${o}</div><div class='ep_profile_contributor_status'>${l}</div></div><p class='ep_profile_user_list_profile_desc' id='ep_profile_users_profile_desc'>\n${s}</p></div> </div>`):(i=`background: url(${a}) no-repeat 50% 50% ; background-size : 69px ;`,`<div data-id='user_list_${e}' class='ep_profile_user_row'><div style='${i}' class='ep_profile_user_img'  id='ep_profile_user_img'></div><div class='ep_profile_user_list_profile_userDesc'><div class='ep_profile_user_list_username'>\n<div class='ep_profile_user_list_username_text' id='ep_profile_users_profile_name'>\n${o}</div><a target='_blank' style='\n${""===t||"#"===t||void 0===t||null==t?"display : none":""}'  class='ep_profile_contributor_link_container' title='\n        ${n.getValidUrl(t)}' href='${n.getValidUrl(t)}'> </a><div class='ep_profile_contributor_status'>${l}</div></div><p class='ep_profile_user_list_profile_desc' id='ep_profile_users_profile_desc'>${s}</p></div> </div>`)},o=(e,o)=>{const a=e.attr("data-anonymouseCount"),r=e.attr("data-user-ids").split(",");if(-1===r.indexOf(o)){r.push(o),e.attr("data-user-ids",r.join(","));const s=parseInt(a)+1;e.attr("data-anonymouseCount",s),e.children(".ep_profile_user_list_profile_userDesc").children(".ep_profile_user_list_username").children(".ep_profile_user_list_username_text").text("Anonymous ×"+s)}},a=(e,o)=>{const a=e.attr("data-anonymouseCount");let r=e.attr("data-user-ids").split(",");r=$.grep(r,e=>e!==o),e.attr("data-user-ids",r.join(","));const s=parseInt(a)-1;return e.attr("data-anonymouseCount",s),s>1?e.children(".ep_profile_user_list_profile_userDesc").children(".ep_profile_user_list_username").children(".ep_profile_user_list_username_text").text("Anonymous ×"+s):e.children(".ep_profile_user_list_profile_userDesc").children(".ep_profile_user_list_username").children(".ep_profile_user_list_username_text").text("Anonymous"),s<1&&e.remove(),s},r=(e,o)=>{const a=e.attr("data-anonymouseCount");let r=e.attr("data-user-ids");r=$.grep(r,e=>e!==o),e.attr("data-user-ids",r);const s=parseInt(a)+1;e.attr("data-anonymouseCount",s),e.children(".ep_profile_user_list_profile_userDesc").children(".ep_profile_user_list_username").children(".ep_profile_user_list_username_text").text("Anonymous ×"+s)},s=(o,a,r,s,t)=>{const l=e(o,"Anonymous",a,"off_Anonymous",r,s,"Today"),i=$("#ep_profile_user_list_offline");if(i.length){const e=$(".ep_profile_user_row[data-id='user_list_off_Anonymous']");e.length?t.insertBefore(e):i.append(t)}else{$("#ep_profile_user_list_container_off").prepend("<div class='ep_profile_user_list_date_title' id='ep_profile_user_list_offline'></div>"),i.append(l)}},t=e=>{const o=$("#ep_profile_user_list_offline");if(o.length){const a=$(".ep_profile_user_row[data-id='user_list_off_Anonymous']");a.length?e.insertBefore(a):o.append(e)}else{$("#ep_profile_user_list_container_off").prepend("<div class='ep_profile_user_list_date_title' id='ep_profile_user_list_offline'></div>"),o.append(e)}e.children(".ep_profile_user_list_profile_userDesc").children(".ep_profile_user_list_username").children(".ep_profile_contributor_status").text("Last seen today")};return{createHTMLforUserList:(e,o,a,r)=>{let s,t="<div id='usersIconList' class='ep_profile_inlineAvatars'>",l="";return $.each(o.reverse(),(e,o)=>{s=`background: url(/static/getUserProfileImage/${o.userId}/${a}) no-repeat 50% 50% ; background-size : 28px;background-color: #fff;`,l=r?"box-shadow: 0px 0px 1px 1px rgba(38,121,255,1);margin: 1px;":"",s+=l,t+=`<div class='avatar' data-userId="${o.userId}" data-id="user_${o.userId}"  id="user_${o.userId}" ><div data-userId="${o.userId}"  class='avatarImg' style='${s}' data-id="user_${o.userId}"></div></div>`}),t+=" </div>",`${t}<span class='slash_profile'>⧸</span><span \n    id='userlist_count' class='userlist_count'>${e}</span> <input  value='Share'  \n      id='ep_profile_modal_share' type='button' class='ep_profile_modal_share'>`},increaseUserFromList:(e,o)=>{const a=`background: url(/static/getUserProfileImage/${e}/${o}) no-repeat 50% 50% ; background-size : 26px;background-color: #fff;`;if(!$(`.avatar[data-id="user_${e}"]`).length){const o=$(`<div class='avatar' data-userId="${e}"  data-id="user_${e}" id="user_${e}" ><div class='avatarImg' data-userId="${e}"  data-id="user_${e}" style='${a}'></div></div>`);o.prependTo("#usersIconList"),o.hide().slideDown(200)}},decreaseUserFromList:function(e,o){$(`.avatar[data-id="user_${e}"]`).animate({opacity:0},1e3,"linear",(function(){$(this).remove()}));const l=$(`.ep_profile_user_row[data-id="user_list_${e}"]`);if(l.length)t(l);else{const o=$('.ep_profile_user_row[data-id="user_list_on_Anonymous"]');if(o.length){const t=$('.ep_profile_user_row[data-id="user_list_off_Anonymous"]');a(o,e),t.length?r(t,e):s(e,"../static/plugins/ep_profile_modal/static/dist/img/user.png",null,null,l)}else{let o=$("#ep_profile_user_list_offline");if(o.length)o.append($(`.ep_profile_user_row[data-id="user_list_${e}"]`));else{$("#ep_profile_user_list_container_off").prepend('<div class="ep_profile_user_list_date_title" \n              id="ep_profile_user_list_offline"></div>'),o=$("#ep_profile_user_list_offline"),$(`.ep_profile_user_row[data-id="user_list_${e}"]`).appendTo(o)}}}const i=`/static/getUserProfileImage/${e}/${o}?t=${(new Date).getTime()}`,n=$(`.ep_profile_user_row[data-id="user_list_${e}"]`);n.length&&n.children(".ep_profile_user_img").css({"background-position":"50% 50%","background-image":`url(${i})`,"background-repeat":"no-repeat","background-size":"69px"})},moveOnlineUserToOffline:t,decreaseFromOnlineAnonymous:a,increaseToOfflineAnonymous:r,createOfflineAnonymousElement:s,manageOnlineOfflineUsers:(a,r,s,t)=>{const l=$("#ep_profile_user_list_container"),i=$("#ep_profile_user_list_container_off");t?$("#ep_profile_modal_load_more_contributors").css({display:"none"}):$("#ep_profile_modal_load_more_contributors").css({display:"block"}),$.each(a,(a,t)=>{if($.grep(r,e=>e.userId===t.userId).length)if("Anonymous"===t.userName){const a=$('.ep_profile_user_row[data-id="user_list_on_Anonymous"]');if(a.length)o(a,t.userId);else{const o=e(t.userId,t.userName,t.imageUrl,"on_Anonymous",t.about,t.homepage,"Online");l.append(o)}s===t.userId&&$(".ep_profile_user_row[data-id='user_list_on_Anonymous']").css({"margin-top":"28px"})}else{if($(`.ep_profile_user_row[data-id="user_list_${t.userId}"]`).length)s===t.userId?$(`.ep_profile_user_row[data-id="user_list_${t.userId}"]`).prependTo(l):$(`.ep_profile_user_row[data-id="user_list_${t.userId}"]`).appendTo(l);else{const o=e(t.userId,t.userName,t.imageUrl,!1,t.about,t.homepage,"Online");try{l.append(o)}catch(e){console.log(e)}}s===t.userId&&$(`.ep_profile_user_row[data-id="user_list_${t.userId}"]`).css({"margin-top":"28px"})}if(""!==t.lastSeenDate&&"Anonymous"!==t.userName)if($(`.ep_profile_user_row[data-id="user_list_${t.userId}"]`).length)$(`.ep_profile_user_row[data-id="user_list_${t.userId}"]`).appendTo(i);else{console.log("value",t);const o=e(t.userId,t.userName,t.imageUrl,!1,t.about,t.homepage,n.getCustomDate(t.lastSeenDate)),a=$("#ep_profile_user_list_offline");a.length?a.append(o):$("#ep_profile_user_list_container_off").append(`<div class='ep_profile_user_list_date_title' id='ep_profile_user_list_offline'>\n                ${o}</div>`)}}),$.each(a,(o,a)=>{if(!$.grep(r,e=>e.userId===a.userId).length&&"Anonymous"===a.userName){const o=$('.ep_profile_user_row[data-id="user_list_off_Anonymous"]');if(o.length){const e=o.attr("data-anonymouseCount"),r=parseInt(e)+1,s=o.attr("data-user-ids").split(",");s.push(a.userId),o.attr("data-user-ids",s.join(",")),o.attr("data-anonymouseCount",r),o.children(".ep_profile_user_list_profile_userDesc").children(".ep_profile_user_list_username").text("Anonymous ×"+r)}else{const o=e(a.userId,"Anonymous",a.imageUrl,"off_Anonymous",a.about,a.homepage,n.getCustomDate(a.lastSeenDate)),r=$("#ep_profile_user_list_offline");r.length?r.append(o):$("#ep_profile_user_list_container_off").append(`<div class='ep_profile_user_list_date_title' id='ep_profile_user_list_offline'>\n                ${o}</div>`)}}})},increaseToOnlineAnonymous:o,createOnlineUserElementInUserList:(o,a,r,s,t)=>{const l=$(`.ep_profile_user_row[data-id="user_list_${o}"]`);if(l.length)l.children(".ep_profile_user_list_profile_userDesc").children(".ep_profile_user_list_username").children(".ep_profile_user_list_username_text").text(a),l.children(".ep_profile_user_img").css({"background-position":"50% 50%","background-image":`url(${r})`,"background-repeat":"no-repeat","background-size":"69px"});else{const l=e(o,a,r,!1,t.about,t.homepage,"Online");if(o===s){const e=$("#ep_profile_user_list_date_title");e.length?$(l).insertAfter(e):$("#ep_profile_user_list_container").prepend(l)}else $("#ep_profile_user_list_container").append(l)}},isThereOnlineAnonymous:()=>{const e=$('.ep_profile_user_row[data-id="user_list_on_Anonymous"]');return!!e.length&&e},checkUserExistInOnlineAnonymous:(e,o)=>-1!==e.attr("data-user-ids").split(",").indexOf(o),createOnlineAnonymousElement:(o,a,r,s)=>{const t=$("#ep_profile_user_list_container"),l=e(o,a,r,"on_Anonymous",s.about,s.homepage,"Online");t.append(l)},removeUserElementInUserList:e=>{$(`.ep_profile_user_row[data-id="user_list_${e}"]`).remove()},paginateContributors:(a,r,s,t)=>{const l=$("#ep_profile_user_list_container_pagination");t&&$("#ep_profile_modal_load_more_contributors").css({display:"none"}),$.each(a,(a,t)=>{const i=$.grep(r,e=>e.userId===t.userId);if(""!==t.lastSeenDate&&"Anonymous"!==t.userName){const o=e(t.userId,t.userName,t.imageUrl,!1,t.about,t.homepage,i.length?"Online":n.getCustomDate(t.lastSeenDate));l.append(o)}if(i.length&&"Anonymous"===t.userName){const a=$('.ep_profile_user_row[data-id="user_list_on_Anonymous"]');if(a.length)o(a,t.userId);else{const o=e(t.userId,t.userName,t.imageUrl,"on_Anonymous",t.about,t.homepage,"Online");l.append(o)}s===t.userId&&$(".ep_profile_user_row[data-id='user_list_on_Anonymous']").css({"margin-top":"28px"})}}),$.each(a,(o,a)=>{if(!$.grep(r,e=>e.userId===a.userId).length&&"Anonymous"===a.userName){const o=$('.ep_profile_user_row[data-id="user_list_off_Anonymous"]');if(o.length){const e=o.attr("data-anonymouseCount"),r=parseInt(e)+1,s=o.attr("data-user-ids").split(",");s.push(a.userId),o.attr("data-user-ids",s.join(",")),o.attr("data-anonymouseCount",r),o.children(".ep_profile_user_list_profile_userDesc").children(".ep_profile_user_list_username").text("Anonymous ×"+r)}else{const o=e(a.userId,"Anonymous",a.imageUrl,"off_Anonymous",a.about,a.homepage);l.append(o)}}})}}})(),a=(()=>{const e=()=>{$("#ep_profile_formModal").addClass("ep_profile_formModal_show"),$("#ep_profile_formModal_overlay").addClass("ep_profile_formModal_overlay_show"),$("#ep_profile_formModal_overlay").css({display:"block"}),setTimeout(()=>{$("#ep_profile_modalForm_name").focus()},1e3)},o=e=>{const o=e.serializeArray(),a={};return $.map(o,(e,o)=>{a[e.name]=e.value}),a},a=()=>{const e=pad.getUserId(),a=pad.getPadId(),r=$("#ep_profile_formModal_msform"),s=o(r),t={};if(localStorage.setItem("formPassed","yes"),(()=>{const e=$('iframe[name="ace_outer"]').contents().find('iframe[name="ace_inner"]').contents().find("#innerdocbody");e.off("keypress"),e.off("mousedown")})(),""===s.ep_profile_modalForm_name||["",null,void 0].includes(localStorage.getItem("formStatus")))return!1;let l="Please welcome "+s.ep_profile_modalForm_name;if(""!==s.ep_profile_modalForm_about_yourself&&(l+=", "+s.ep_profile_modalForm_about_yourself),""!==s.ep_profile_modalForm_homepage){l+=", "+n.getValidUrl(s.ep_profile_modalForm_homepage)}t.messageChatText=""+l,t.target="profile",t.userId=e,t.time=new Date;const i={type:"ep_rocketchat",action:"ep_rocketchat_sendMessageToChat_login",userId:e,data:t,padId:a};pad.collabClient.sendMessage(i)},r=()=>{$("#ep_profile_formModal_overlay").removeClass("ep_profile_formModal_overlay_show"),$("#ep_profile_formModal_overlay").css({display:"none"}),a()};return{showModal:e,hideFormModalOverlay:r,handleOnCloseOverlay:a,resetModal:function(){$("#ep_profile_formModal_msform fieldset").each((function(e){0===e?$(this).show():$(this).hide()}))},getFormData:o,initModal:function(e){const a=$("#ep_profile_formModal_script").tmpl(e);let s,t,l,_;$("body").append(a),$(".skip").click((function(){if(_)return!1;$("#ep_profile_modalForm_name").css({border:"1px solid gray"}),_=!0,s=$(this).parent(),t=$(this).parent().next(),s.hide(),t.show(),_=!1})),$(".close , #ep_profile_formModal_overlay , .ep_profile_formModal_topClose").click(()=>($("#ep_profile_formModal").removeClass("ep_profile_formModal_show"),r(),!1)),$(".previous").click((function(){if(_)return!1;_=!0,s=$(this).parent(),l=$(this).parent().prev(),s.hide(),l.show(),_=!1})),$(".clear").click((function(){n.resetAllProfileImage($(this).attr("data-userId"),$(this).attr("data-padId"))}));const p=()=>{const e=pad.getUserId(),a=pad.getPadId(),r=$("#ep_profile_formModal_msform"),s=o(r);if("Yes"===s.ep_profile_modalForm_push){const e=new CustomEvent("ep_push_notification",{detail:{eventName:"checkPermission"}});window.dispatchEvent(e)}const t={type:"ep_profile_modal",action:"ep_profile_modal_info",userId:e,data:s,padId:a};pad.collabClient.sendMessage(t)},d=()=>{const o=pad.getUserId(),a=pad.getPadId();$("#ep_profile_formModal").removeClass("ep_profile_formModal_show"),(()=>{const o=pad.getUserId(),a=new FormData,r=$("#profile_file_modal")[0].files[0];a.append("file",r),r&&$.ajax({url:`/static/${e.padId}/pluginfw/ep_profile_modal/upload/${o}`,type:"post",data:a,contentType:!1,processData:!1,beforeSend:()=>{i.refreshLoadingImage(o,e.padId)},error:a=>{switch(i.refreshUserImage(o,e.padId),$("#profile_modal_selected_image").attr("style",(e,o)=>o&&o.replace(/background-image[^;]+;?/g,"")),a.status){case 413:$.gritter.add({title:"Error",text:"ep_profile_modal: image size is large.",sticky:!0,class_name:"error"})}},success:a=>{i.refreshUserImage(o,e.padId),$("#profile_modal_selected_image").attr("style",(e,o)=>o&&o.replace(/background-image[^;]+;?/g,""))}})})(),r(),p();const s=$("#ep_profile_modalForm_name").val();i.userLogin({email:$("#ep_profile_modalForm_email").val(),username:s}),setTimeout(()=>{i.refreshUserImage(o,a)},2200)},u=(e,o)=>{if(_)return!1;const a=e.attr("data-section");if(localStorage.setItem("formStatus",a),"name"===a){if(""===$("#ep_profile_modalForm_name").val())return $("#ep_profile_modalForm_name").css({border:"1px solid red"}),!1;const e=$("#ep_profile_modalForm_name").val();$("#ep_profile_modalForm_name").css({border:"0px solid gray"}),i.userLogin({username:e}),n.loginByEmailAndUsernameWithoutValidation(e,"",!1)}if("email"===a){const e=$("#ep_profile_modalForm_email").val();if(!n.isEmail(e)||""===e)return $("#ep_profile_modalForm_email").css({border:"1px solid red"}),!1;const o=$("#ep_profile_modalForm_name").val();n.loginByEmailAndUsernameWithoutValidation(o,e,!0),((e,o)=>{const a=$("#ep_profile_modal_verification").text();$.ajax({url:`/static/${pad.getPadId()}/pluginfw/ep_profile_modal/sendVerificationEmail/$\n        {pad.getUserId()}/${o}/${e}`,type:"get",data:{},contentType:!1,processData:!1,beforeSend:()=>{$("#ep_profile_modal_verification").text("Sending...")},error:e=>{$("#ep_profile_modal_verification").text("Error"),setTimeout(()=>{$("#ep_profile_modal_verification").text(a)},2e3)},success:e=>{$("#ep_profile_modal_verification").text("Verification email has been sent."),$("#ep_profile_modal_verification").attr("data-verification-status","true")}})})(e,o),$("#ep_profile_modalForm_email").css({border:"0px solid gray"})}if("homepage"===a){const e=$("#ep_profile_modal_homepage").val();if(!n.isValid(e)||""===e)return $("#ep_profile_modal_homepage").css({border:"1px solid red"}),!1;$("#ep_profile_modal_homepage").css({border:"0px solid gray"}),p()}if("push"===a&&($("#ep_profile_modalForm_push").val(!0),$("#ep_profile_modalForm_push").attr("checked","checked"),$("#ep_profile_modal_push").val("Yes"),p()),_=!0,e.hide(),o.length){o.show();const e=o.attr("data-section");"email"===e&&$("#ep_profile_modalForm_email").focus().select(),"homepage"===e&&$("#ep_profile_modal_homepage").focus().select(),"bio"===e&&$("#ep_profile_modalForm_about_yourself").focus().select()}else d();_=!1};$("#ep_profile_formModal_msform fieldset").on("keypress",e=>{13===e.keyCode&&(e.preventDefault(),$(e.target).parent().find(".next").click())}),$(".next").click((function(){s=$(this).parent(),t=$(this).parent().next(),u(s,t)})),$(".submit").click(()=>(d(),!1)),$("#profile_file_modal").on("change",e=>{const o=$("#profile_file_modal")[0].files[0],a=URL.createObjectURL(o);$("#profile_modal_selected_image").css({"background-position":"50% 50%","background-image":`url(${a})`,"background-repeat":"no-repeat","background-size":"64px"})})},allEventListener:()=>{const o=$('iframe[name="ace_outer"]').contents().find('iframe[name="ace_inner"]').contents().find("#innerdocbody");o.on("keypress",o=>{e()}),o.on("mousedown",o=>{1===o.which&&e()})}}})(),r={initiate:e=>{const o=$("#ep_profile_users_profile_script").tmpl(e);$("body").append(o)},initiateListeners:()=>{const e=e=>{const o=pad.getPadId();$.ajax({url:`/static/${o}/pluginfw/ep_profile_modal/getUserInfo/${e}`,type:"get",data:{},contentType:!1,processData:!1,beforeSend:()=>{const e="../static/plugins/ep_profile_modal/static/dist/img/loading.gif";$("#ep_profile_users_profile_userImage").css({"background-position":"50% 50%","background-image":`url(${e})`,"background-repeat":"no-repeat","background-size":"69px"}),$("#ep_profile_user_img").css({"background-position":"50% 50%","background-image":`url(${e})`,"background-repeat":"no-repeat","background-size":"69px"}),$("#ep_profile_users_profile_name").text(""),$("#ep_profile_users_profile_desc").text(""),$("#ep_profile_users_profile").addClass("ep_profile_formModal_show"),n.showGeneralOverlay()},error:e=>{$("#ep_profile_users_profile").removeClass("ep_profile_formModal_show"),n.hideGeneralOverlay()},success:a=>{const r=`/static/getUserProfileImage/${e}/${o}?t=${(new Date).getTime()}`;let s=a.user.username;null!=s&&""!==s||(s="Anonymous");const t=a.user.about||"",l=a.user.homepage||"";$("#ep_profile_users_profile_name").text(s),$("#ep_profile_users_profile_desc").text(t),""===l?$("#ep_profile_users_profile_homepage").hide():$("#ep_profile_users_profile_homepage").attr({href:n.getValidUrl(l),target:"_blank"}),$("#ep_profile_users_profile_userImage").css({"background-position":"50% 50%","background-image":`url(${r})`,"background-repeat":"no-repeat","background-size":"69px"}),$("#ep_profile_user_img").css({"background-position":"50% 50%","background-image":`url(${r})`,"background-repeat":"no-repeat","background-size":"69px"})}})};$("#usersIconList").on("avatarClick",(o,a)=>{!a||a.indexOf("a.")<0||e(a)}),$("#usersIconList").on("click",".avatar",(function(){const o=$(this).attr("data-userId");e(o)})),$("#ep_profile_users_profile_close").on("click",()=>{$("#ep_profile_users_profile").removeClass("ep_profile_formModal_show"),n.hideGeneralOverlay()})}},s=(e,s)=>(r.initiateListeners(),$("#ep_profile_modalForm_push").on("change",e=>{const o=$("#ep_profile_modalForm_push"),a=o.is(":checked");o.attr("checked",a),o.val(a)}),$("#ep_profile_modal_save").on("click",()=>{const e=pad.getUserId(),o=pad.getPadId(),a=$("#ep_profile_modal-username");if(""===a.val())return a.css({border:"1px solid red"}),!1;a.css({border:"0"});const r=$("#ep_profile_modal_one"),s=n.getFormData(r);if(s.ep_profile_modalForm_push){const e=new CustomEvent("ep_push_notification",{detail:{eventName:"checkPermission"}});window.dispatchEvent(e)}const t={type:"ep_profile_modal",action:"ep_profile_modal_info",userId:e,data:s,padId:o};pad.collabClient.sendMessage(t),pad.collabClient.updateUserInfo({userId:o,name:a.val(),colorId:"#b4b39a"}),"login"===window.userStatus&&($("#ep_profile_modal").hasClass("ep_profile_modal-show")?($("#ep_profile_modal").removeClass("ep_profile_modal-show"),n.hideGeneralOverlay()):($("#ep_profile_modal").addClass("ep_profile_modal-show"),$("#online_ep_profile_modal_status").show(),$("#offline_ep_profile_modal_status").hide(),n.showGeneralOverlay()))}),$("#userlist_count").on("click",()=>{const e=$("#ep_profile_modal_user_list").attr("data-page")||1,a=$("#ep_profile_modal_user_list").attr("data-pageLoaded")||!1,r=$("#ep_profile_user_list_container");"true"!==a&&$.ajax({url:`/static/${pad.getPadId()}/pluginfw/ep_profile_modal/getContributors/${e}/`,type:"get",data:{},contentType:!1,processData:!1,beforeSend:()=>{$("#ep_profile_user_list_container").css({display:"none"}),$("#ep_profile_modal_load_more_contributors").css({display:"none"}),r.css({display:"none"})},error:e=>{$("#contributorsLoading").css({display:"none"}),r.css({display:"block"})},success:e=>{r.css({display:"block"}),$("#contributorsLoading").css({display:"none"}),$("#ep_profile_user_list_container").css({display:"block"}),$("#ep_profile_modal_user_list").attr("data-pageLoaded","true");const a=pad.collabClient.getConnectedUsers();o.manageOnlineOfflineUsers(e.data,a,pad.getUserId(),e.lastPage)}})}),$("#ep_profile_modal_load_more_contributors").on("click",()=>{let e=$("#ep_profile_modal_user_list").attr("data-page")||1;e++,$.ajax({url:`/static/${pad.getPadId()}/pluginfw/ep_profile_modal/getContributors/${e}/`,type:"get",data:{},contentType:!1,processData:!1,beforeSend:()=>{$("#loadMoreLoading").show(),$("#ep_profile_modal_load_more_contributors").css({display:"none"})},error:e=>{$("#loadMoreLoading").hide(),$("#ep_profile_modal_load_more_contributors").css({display:"block"})},success:a=>{$("#ep_profile_modal_load_more_contributors").css({display:"block"}),$("#loadMoreLoading").hide(),$("#ep_profile_modal_user_list").attr("data-page",e);const r=pad.collabClient.getConnectedUsers();o.manageOnlineOfflineUsers(a.data,r,pad.getUserId(),a.lastPage)}})}),$("#userlist_count,#ep_profile_modal_user_list_close").on("click",()=>{$("#ep_profile_modal_user_list").hasClass("ep_profile_modal-show")?($("#ep_profile_modal_user_list").removeClass("ep_profile_modal-show"),n.hideGeneralOverlay()):(n.showGeneralOverlay(),$("#ep_profile_modal_user_list").addClass("ep_profile_modal-show"))}),$("#ep_profile_modal_verification").on("click",(function(){const e=$(this).attr("data-verification-status"),o=$(this).text();return"true"!==e&&$.ajax({url:`/static/${pad.getPadId()}/pluginfw/ep_profile_modal/sendVerificationEmail/${pad.getUserId()}/null/null`,type:"get",data:{},contentType:!1,processData:!1,beforeSend:()=>{$("#ep_profile_modal_verification").text("Sending...")},error:e=>{$("#ep_profile_modal_verification").text("Error"),setTimeout(()=>{$("#ep_profile_modal_verification").text(o)},2e3)},success:e=>{$("#ep_profile_modal_verification").text("Verification email has been sent."),$("#ep_profile_modal_verification").attr("data-verification-status","true")}}),!1})),$("#ep_profile_modal_share").on("click",()=>{const e=document.createElement("input"),o=window.location.href;document.body.appendChild(e),e.value=o,e.select(),document.execCommand("copy"),document.body.removeChild(e),$.gritter.add({text:"Link copied to clipboard"})}),$("#ep-profile-button").on("click",()=>{"login"===window.userStatus?$("#ep_profile_modal").hasClass("ep_profile_modal-show")?$("#ep_profile_modal").removeClass("ep_profile_modal-show"):($("#ep_profile_modal").addClass("ep_profile_modal-show"),$("#online_ep_profile_modal_status").show(),$("#offline_ep_profile_modal_status").hide(),n.showGeneralOverlay()):(a.resetModal(),a.showModal())}),$("#ep_profile_modal_close").on("click",()=>{$("#ep_profile_modal").hasClass("ep_profile_modal-show")?($("#ep_profile_modal").removeClass("ep_profile_modal-show"),n.hideGeneralOverlay()):(n.showGeneralOverlay(),$("#ep_profile_modal").addClass("ep_profile_modal-show"))}),$("#ep_profile_modal_close_ask").on("click",()=>{$("#ep_profile_modal_ask").hasClass("ep_profile_modal-show")?$("#ep_profile_modal_ask").removeClass("ep_profile_modal-show"):$("#ep_profile_modal_ask").addClass("ep_profile_modal-show")}),$("#ep_profile_modal_signout").on("click",()=>{a.resetModal();const e=pad.getUserId(),o=pad.getPadId();localStorage.setItem("formStatus",""),clientVars.ep_profile_modal.userStatus="1",window.userStatus="out";const r={type:"ep_profile_modal",action:"ep_profile_modal_logout",email:$("#ep_profile_hidden_email").val(),userId:e,padId:o};clientVars.ep_profile_modal.userStatus="1",pad.collabClient.sendMessage(r),$("#ep_profile_modal").removeClass("ep_profile_modal-show"),$("#online_ep_profile_modal_status").hide(),$("#offline_ep_profile_modal_status").show(),_.resetProfileModalFields(),n.hideGeneralOverlay(),$(`.avatar[data-id="user_${e}"]`).attr({style:""}),i.userLogout()}),$("#profile_file").on("change",e=>{const o=pad.getUserId(),a=new FormData,r=$("#profile_file")[0].files[0];a.append("file",r),r&&$.ajax({url:`/static/${clientVars.padId}/pluginfw/ep_profile_modal/upload/${o}`,type:"post",data:a,contentType:!1,processData:!1,beforeSend:()=>{i.refreshLoadingImage(o,clientVars.padId)},error:e=>{i.refreshUserImage(o,clientVars.padId)},success:e=>{i.refreshUserImage(o,clientVars.padId)}})}),$("#ep_profile_modal_submit").on("click",()=>{const e=$("#ep_profile_modal_username").val(),o=$("#ep_profile_modal_email").val();n.loginByEmailAndUsername(e,o)}),$("#ep_profile_modal_login").on("click",()=>{const e=$("#ep_profile_modal-username").val(),o=$("#ep_profile_modal-email").val();n.loginByEmailAndUsername(e,o),$("#ep_profile_modal").removeClass("ep_profile_modal-show")}),$("#ep_profile_general_overlay").on("click",()=>{n.hideGeneralOverlay()}),[]),t=(e,s)=>{((e,o,a)=>{e.addEventListener?e.addEventListener(o,a,!1):e.attachEvent&&e.attachEvent("on"+o,a)})(window,"message",e=>{const o=e.data.eventName,r=e.data.data;"showEtherpadModal"===o&&a.showModal(),"showProfileDetailModal"===o&&$("#usersIconList").trigger("avatarClick",r.userId)});const t=pad.getUserId();a.initModal(clientVars),"yes"!==localStorage.getItem("formPassed")&&a.allEventListener(),r.initiate(clientVars);let l=$("#ep_profile_modal_script").tmpl(clientVars);$("body").append(l),l=$("#ep_profile_modal_user_list_script").tmpl(clientVars),$("body").append(l),l=$("#ep_profile_modal_general_script").tmpl(),$("body").append(l);const i=`\n      background : url(/static/getUserProfileImage/${t}/${clientVars.padId}) no-repeat 50% 50%;\n      background-size :32px\n    `,n=pad.collabClient.getConnectedUsers(),_=o.createHTMLforUserList(clientVars.ep_profile_modal.contributed_authors_count,n,clientVars.padId,clientVars.ep_profile_modal.verified);$("body").hasClass("mobileView")||(0===$("#pad_title").length&&$("body").prepend("\n          <div id='pad_title'>\n            <div class=\"title_container\">\n              <span contenteditable style=\"color:#000\" id='title'>Loading...</span>\n            </div>\n            <button id='save_title'></button>\n          </div>\n        "),$("#pad_title").append(`\n        <div class='ep_profile_modal_header'>\n          <div class='userlist' id='userlist'>\n          ${_}\n          </div>\n          <div class='ep-profile-button' id='ep-profile-button'>\n          <div id='ep-profile-image' style='${i}' /></div>\n        </div>\n      `)),"2"===clientVars.ep_profile_modal.userStatus?window.userStatus="login":window.userStatus="out";const p={type:"ep_profile_modal",action:"ep_profile_modal_ready",userId:t,padId:clientVars.padId,data:clientVars.ep_profile_modal};return pad.collabClient.sendMessage(p),"Anonymous"===clientVars.ep_profile_modal.userName&&pad.collabClient.updateUserInfo({userId:t,name:"Anonymous",colorId:"#b4b39a"}),[]},l={handleClientMessage_USER_NEWINFO:(e,a)=>{const r=pad.getPadId();return o.increaseUserFromList(a.payload.userId,r),[]},handleClientMessage_USER_LEAVE:(e,a)=>{const r=pad.getPadId();return o.decreaseUserFromList(a.payload.userId,r),[]},handleClientMessage_CUSTOM:(e,a,r)=>{const s=pad.getUserId();if("totalUserHasBeenChanged"===a.payload.action){const e=a.payload.totalUserCount;$("#userlist_count").text(e)}if("EP_PROFILE_USER_IMAGE_CHANGE"===a.payload.action&&i.refreshGeneralImage(a.payload.userId,a.payload.padId),"EP_PROFILE_USER_LOGOUT_UPDATE"===a.payload.action){const e=`/static/getUserProfileImage/${a.payload.userId}/${a.payload.padId}?t=${(new Date).getTime()}`;s===a.payload.userId?(i.refreshUserImage(s,a.payload.padId),i.logoutCssFix(s)):i.refreshGeneralImage(a.payload.userId,a.payload.padId),_.resetGeneralFields(a.payload.userId);const r=o.isThereOnlineAnonymous();r?o.increaseToOnlineAnonymous(r,a.payload.userId):o.createOnlineAnonymousElement(a.payload.userId,"Anonymous",e,{}),o.removeUserElementInUserList(a.payload.userId)}if("EP_PROFILE_USER_LOGIN_UPDATE"===a.payload.action){const e=o.isThereOnlineAnonymous();"Anonymous"===a.payload.userName?(e?o.increaseToOnlineAnonymous(e,a.payload.userId):o.createOnlineAnonymousElement(a.payload.userId,a.payload.userName,a.payload.img,a.payload.user),o.removeUserElementInUserList(a.payload.userId)):(e&&o.checkUserExistInOnlineAnonymous(e,a.payload.userId)&&o.decreaseFromOnlineAnonymous(e,a.payload.userId),o.createOnlineUserElementInUserList(a.payload.userId,a.payload.userName,a.payload.img,s,a.payload.user)),s===a.payload.userId?(i.refreshUserImage(s,a.payload.padId),_.syncAllFormsData(a.payload.userId,a.payload.user)):(i.refreshGeneralImage(a.payload.userId,a.payload.padId),_.syncGeneralFormsData(a.payload.userId,a.payload.user))}return[]}},i={userLogin:e=>{window.userStatus="login",clientVars.ep_profile_modal.userStatus="2",pad.collabClient.updateUserInfo({userId:pad.getUserId(),name:e.username,colorId:"#b4b39a"})},userLogout:()=>{window.userStatus="logout",clientVars.ep_profile_modal.userStatus="1",pad.collabClient.updateUserInfo({userId:pad.getUserId(),name:"Anonymous",colorId:"#b4b39a"})},logoutCssFix:e=>{const o=$(`.avatarImg[data-id="user_${e}"]`);o.length&&o.css({margin:"0px","box-shadow":"none"})},refreshUserImage:(e,o)=>{const a=`/static/getUserProfileImage/${e}/${o}?t=${(new Date).getTime()}`,r=$(`.avatarImg[data-id="user_${e}"]`);r.length&&r.css({"background-position":"50% 50%","background-image":`url(${a})`,"background-repeat":"no-repeat","background-size":"28px","background-color":"#fff"}),$(".ep_profile_modal_section_image_big_ask").css({"background-position":"50% 50%","background-image":`url(${a})`,"background-repeat":"no-repeat"}),$(".ep_profile_modal_section_image_big").css({"background-position":"50% 50%","background-image":`url(${a})`,"background-repeat":"no-repeat","background-size":"72px"}),$("#ep-profile-image").css({"background-position":"50% 50%","background-image":`url(${a})`,"background-repeat":"no-repeat","background-size":"32px"});const s=$(`.ep_profile_user_row[data-id="user_list_${e}"]`);s.length&&s.children(".ep_profile_user_img").css({"background-position":"50% 50%","background-image":`url(${a})`,"background-repeat":"no-repeat","background-size":"69px"});const t=$(`.avatar[data-id="${e}"]`);t.length&&t.children(".ep_rocketchat_onlineUsersList_avatarImg").css({"background-position":"50% 50%","background-image":`url(${a})`,"background-repeat":"no-repeat","background-size":"28px"})},refreshLoadingImage:(e,o)=>{const a="../static/plugins/ep_profile_modal/static/dist/img/loading.gif",r=$(`.avatarImg[data-id="user_${e}"]`);r.length&&r.css({"background-position":"50% 50%","background-image":`url(${a})`,"background-repeat":"no-repeat","background-size":"28px","background-color":"#fff"}),$(".ep_profile_modal_section_image_big_ask").css({"background-position":"50% 50%","background-image":`url(${a})`,"background-repeat":"no-repeat"}),$(".ep_profile_modal_section_image_big").css({"background-position":"50% 50%","background-image":`url(${a})`,"background-repeat":"no-repeat","background-size":"72px"}),$("#ep-profile-image").css({"background-position":"50% 50%","background-image":`url(${a})`,"background-repeat":"no-repeat","background-size":"32px"});const s=$(`.ep_profile_user_row[data-id="user_list_${e}"]`);s.length&&s.children(".ep_profile_user_img").css({"background-position":"50% 50%","background-image":`url(${a})`,"background-repeat":"no-repeat","background-size":"69px"})},refreshGeneralImage:(e,o)=>{const a=`/static/getUserProfileImage/${e}/${o}?t=${(new Date).getTime()}`,r=$(`.avatarImg[data-id="user_${e}"]`);r.length&&r.css({"background-position":"50% 50%","background-image":`url(${a})`,"background-repeat":"no-repeat","background-size":"28px","background-color":"#fff"});const s=$(`.ep_profile_user_row[data-id="user_list_${e}"]`);s.length&&s.children(".ep_profile_user_img").css({"background-position":"50% 50%","background-image":`url(${a})`,"background-repeat":"no-repeat","background-size":"69px"})}},n=(()=>{const e=e=>{const o=$(e);if(o.length<=0||!o[0])return!0;o.animate({scrollTop:o[0].scrollHeight},{duration:400,queue:!1})},o=e=>""===e||/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(e),a=e=>["January","February","March","April","May","June","July","August","September","October","November","December"][e-1];return{resetAllProfileImage:(e,o)=>{$.ajax({url:`/static/${o}/pluginfw/ep_profile_modal/resetProfileImage/${e}`,type:"get",data:{},contentType:!1,processData:!1,beforeSend:()=>{i.refreshLoadingImage(e,o)},error:a=>{i.refreshUserImage(e,o)},success:a=>{i.refreshUserImage(e,o)}})},sendSignOutMessage:(e,o)=>{const a={type:"ep_profile_modal",action:"ep_profile_modal_send_signout_message",userId:e,padId:o};pad.collabClient.sendMessage(a)},addTextChatMessage:o=>{const a="author-"+o.userId.replace(/[^a-y0-9]/g,e=>"."===e?"-":`z${e.charCodeAt(0)}z`);let r=""+new Date(o.time).getMinutes(),s=""+new Date(o.time).getHours();1===r.length&&(r="0"+r),1===s.length&&(s="0"+s);const t=`<p><span class='time ${a}'>${`${s}:${r}`}</span> ${o.text}</p>`;$(document).find("#chatbox #chattext").append(t),e("#chatbox #chattext")},scrollDownToLastChatText:e,loginByEmailAndUsernameWithoutValidation:(e,o,a)=>{clientVars.ep_profile_modal.userStatus="2",window.userStatus="login";const r={type:"ep_profile_modal",action:"ep_profile_modal_login",email:o,userId:pad.getUserId(),name:e,padId:pad.getPadId(),suggestData:a};pad.collabClient.sendMessage(r)},loginByEmailAndUsername:(e,a)=>{if(""===e||!o(a))return o(a)||($("#ep_profile_modal_email").focus(),$("#ep_profile_modal_email").addClass("ep_profile_modal_validation_error")),!1;{$("#ep_profile_modal_email").removeClass("ep_profile_modal_validation_error"),clientVars.ep_profile_modal.userStatus="2",window.userStatus="login";const o={type:"ep_profile_modal",action:"ep_profile_modal_login",email:a,userId:pad.getUserId(),name:e,padId:pad.getPadId(),suggestData:!1};pad.collabClient.sendMessage(o),i.userLogin({email:a,username:e}),$("#online_ep_profile_modal_status").show(),$("#offline_ep_profile_modal_status").hide()}},isEmail:o,isValid:e=>/^(http:\/\/www\.|https:\/\/www\.|http:\/\/|https:\/\/)?[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?(\/.*)?$/.test(e),getFormData:e=>{const o=e.serializeArray(),a={};return $.map(o,(e,o)=>{a[e.name]=e.value}),a},setFormData:(e,o)=>{$.map(o,(e,o)=>{$("#"+o).val(e)})},isUsername:e=>/^([a-zA-Z0-9_.+-])/.test(e),showGeneralOverlay:()=>{$("#ep_profile_general_overlay").addClass("ep_profile_formModal_overlay_show"),$("#ep_profile_general_overlay").css({display:"block"})},hideGeneralOverlay:()=>{$("#ep_profile_general_overlay").removeClass("ep_profile_formModal_overlay_show"),$("#ep_profile_general_overlay").css({display:"none"}),$("#ep_profile_modal").removeClass("ep_profile_modal-show"),$("#ep_profile_modal_user_list").removeClass("ep_profile_modal-show"),$("#ep_profile_users_profile").removeClass("ep_profile_formModal_show")},getValidUrl:e=>{if(""===e||!e)return"";let o=window.decodeURIComponent(e);return o=o.trim().replace(/\s/g,""),/^(:\/\/)/.test(o)?"http"+o:/^(f|ht)tps?:\/\//i.test(o)?o:"http://"+o},getMonthName:a,getCustomeFormatDate:e=>"today"===e||"yesterday"===e?"Last seen "+e:`Last seen ${(e=e.split("-"))[2]} ${a(e[1])} ${e[0]}`,getCustomDate:e=>(console.log(e,"date"),"today"===e||"yesterday"===e?"Last seen "+e:`Last seen ${(e=e.split("-"))[2]}/${e[1]}/${e[0]}`)}})(),_={syncAllFormsData:(e,o)=>{if(void 0===o)return;const a=$(`.ep_profile_user_row[data-id="user_list_${e}"]`);if(a.length){const e=a.children(".ep_profile_user_list_profile_userDesc").children(".ep_profile_user_list_username");e.children(".ep_profile_user_list_username_text").text(o.username),a.children(".ep_profile_user_list_profile_userDesc").children(".ep_profile_user_list_profile_desc").text(o.about),o.homepage&&e.children(".ep_profile_contributor_link_container").attr({href:n.getValidUrl(o.homepage)}),e.children(".ep_profile_contributor_status").text("Online")}$("#ep_profile_modal-username").val(o.username),$("#ep_profile_modal-about").val(o.about),$("#ep_profile_modal-homepage").val(o.homepage),$("#ep_profile_modal-email").val(o.email),!0===o.verified?($("#ep_profile_modal_verification").attr("data-verification-status","true"),$("#ep_profile_modal_verification").text("Verified")):($("#ep_profile_modal_verification").attr("data-verification-status","false"),$("#ep_profile_modal_verification").text("Send verification email"))},syncGeneralFormsData:(e,o)=>{const a=$(`.ep_profile_user_row[data-id="user_list_${e}"]`);if(a.length){const e=a.children(".ep_profile_user_list_profile_userDesc").children(".ep_profile_user_list_username");e.children(".ep_profile_user_list_username_text").text(o.username),a.children(".ep_profile_user_list_profile_userDesc").children(".ep_profile_user_list_profile_desc").text(o.about),e.children(".ep_profile_contributor_link_container").attr({href:n.getValidUrl(o.homepage)}),e.children(".ep_profile_contributor_status").text("Online")}},resetProfileModalFields:()=>{$("#ep_profile_modal-username").val(""),$("#ep_profile_modal-about").val(""),$("#ep_profile_modal-homepage").val(""),$("#ep_profile_modal-email").val(""),$("#ep_profile_modalForm_name").val(""),$("#ep_profile_modalForm_email").val(""),$("#ep_profile_modal_homepage").val(""),$("#ep_profile_modalForm_about_yourself").val("")},resetGeneralFields:e=>{const o=$(`.ep_profile_user_row[data-id="user_list_${e}"]`);if(o.length){const e=o.children(".ep_profile_user_list_profile_userDesc").children(".ep_profile_user_list_username");e.children(".ep_profile_user_list_username_text").text(""),o.children(".ep_profile_user_list_profile_userDesc").children(".ep_profile_user_list_profile_desc").text(""),e.children(".ep_profile_contributor_link_container").attr({href:""}),e.children(".ep_profile_contributor_status").text("")}}};return{documentReady:e,contributors:o,profileForm:a,usersProfileSection:r,postAceInit:s,aceInitialized:t,handleClientMessage:l,helper:i,shared:n,syncData:_}})();
//# sourceMappingURL=ep.profile.modal.mini.js.map
